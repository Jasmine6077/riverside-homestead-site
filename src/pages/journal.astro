---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Journal | Riverside Homestead">
  <!-- Journal Hero -->
  <section class="journalPageHero journalHeroClean">
    <div class="container journalPageHeroInner">
      <h1 class="journalPageTitle">Journal</h1>
      <div class="journalPageDash" aria-hidden="true"></div>
      <p class="journalPageIntro">
        A living space for updates, reflections, and little moments.
      </p>
    </div>
  </section>

  <!-- Controls -->
  <section class="journalControls">
    <div class="container journalControlsInner">
      <div class="journalSearchWrap">
        <label class="srOnly" for="journalSearch">Search journal entries</label>
        <input
          id="journalSearch"
          class="journalSearch"
          type="search"
          placeholder="Search entries (title or summary)…"
          autocomplete="off"
        />
      </div>

      <div class="journalSortWrap">
        <label class="srOnly" for="journalSort">Sort entries</label>
        <select id="journalSort" class="journalSort">
          <option value="newest" selected>Newest first</option>
          <option value="oldest">Oldest first</option>
        </select>
      </div>
    </div>
  </section>

  <!-- Feed -->
  <section class="journalFeed">
    <div class="container journalFeedInner">
      <div class="journalCardsGrid" id="journalGrid">

        <!-- Coming Soon Card -->
        <article class="journalEntryCard journalCardFeatured" data-title="coming soon" data-summary="we are setting up a simple mobile-friendly way to post.">
          <div class="journalEntryMeta">
            <span class="journalEntryDate">Coming soon</span>
          </div>
          <h3 class="journalEntryTitle">We’re building something gentle</h3>
          <p class="journalEntrySummary">
            This journal is being set up so new posts can be added easily (even from a phone).
            Check back soon for updates and new entries.
          </p>
          <div class="journalEntryActions">
            <a class="journalReadMore" href="/about">Meet the Maker →</a>
          </div>
        </article>

        <!-- Instagram Card -->
        <article class="journalEntryCard" data-title="instagram updates" data-summary="see updates on instagram riversidehomesteadmaine.">
          <div class="journalEntryMeta">
            <span class="journalEntryDate">Quick updates</span>
          </div>
          <h3 class="journalEntryTitle">See updates on Instagram</h3>
          <p class="journalEntrySummary">
            For little behind-the-scenes moments, product drops, and day-to-day life,
            follow along on Instagram.
          </p>
          <div class="journalEntryActions">
            <a
              class="btnGreen journalBtn"
              href="https://www.instagram.com/riversidehomesteadmaine/"
              target="_blank"
              rel="noopener noreferrer"
            >
              Visit @riversidehomesteadmaine
            </a>
          </div>
        </article>

        <!-- Example placeholders (you can delete these later) -->
        <article class="journalEntryCard" data-date="2026-01-12" data-title="a quiet beginning" data-summary="a small beginning, written with care.">
          <div class="journalEntryMeta">
            <span class="journalEntryDate">January 12, 2026</span>
          </div>
          <h3 class="journalEntryTitle">A quiet beginning</h3>
          <p class="journalEntrySummary">
            A small beginning, written with care — the kind of day where you notice the light
            and decide to move a little slower.
          </p>
          <div class="journalEntryActions">
            <span class="journalPill">Reflection</span>
            <span class="journalPill">Slow living</span>
          </div>
        </article>

        <article class="journalEntryCard" data-date="2026-01-05" data-title="learning to soften" data-summary="movement, rest, and the kind of healing that happens quietly.">
          <div class="journalEntryMeta">
            <span class="journalEntryDate">January 5, 2026</span>
          </div>
          <h3 class="journalEntryTitle">Learning to soften</h3>
          <p class="journalEntrySummary">
            Movement, rest, and the kind of healing that happens quietly — not forced,
            just allowed.
          </p>
          <div class="journalEntryActions">
            <span class="journalPill">Healing</span>
            <span class="journalPill">Body</span>
          </div>
        </article>

      </div>

      <!-- Empty state (shown by JS when search filters everything out) -->
      <div class="journalEmptyCard" id="journalEmpty" hidden>
        <h3>Nothing matches that search</h3>
        <p>Try a different word (like “healing”, “salve”, “slow”, “spring”, etc.).</p>
      </div>
    </div>
  </section>

  <script is:inline>
    // Simple client-side search + sort (no CMS needed)
    const searchEl = document.getElementById("journalSearch");
    const sortEl = document.getElementById("journalSort");
    const grid = document.getElementById("journalGrid");
    const empty = document.getElementById("journalEmpty");

    const cards = Array.from(grid.querySelectorAll(".journalEntryCard"));

    function getCardText(card) {
      const t = (card.getAttribute("data-title") || "").toLowerCase();
      const s = (card.getAttribute("data-summary") || "").toLowerCase();
      const inner = (card.textContent || "").toLowerCase();
      return (t + " " + s + " " + inner).trim();
    }

    function getCardDate(card) {
      // Only cards with data-date participate in sorting by date.
      // Featured cards (coming soon / instagram) stay pinned at the top.
      const d = card.getAttribute("data-date");
      if (!d) return null;
      const time = Date.parse(d);
      return Number.isFinite(time) ? time : null;
    }

    function apply() {
      const q = (searchEl.value || "").trim().toLowerCase();

      // filter
      let visibleCount = 0;
      for (const card of cards) {
        const isMatch = !q || getCardText(card).includes(q);
        card.hidden = !isMatch;
        if (isMatch) visibleCount++;
      }

      empty.hidden = visibleCount !== 0;

      // sort (only within non-featured dated cards)
      const featured = cards.filter(c => c.classList.contains("journalCardFeatured"));
      const others = cards.filter(c => !c.classList.contains("journalCardFeatured"));

      const dated = others.filter(c => getCardDate(c) !== null);
      const undated = others.filter(c => getCardDate(c) === null);

      const dir = sortEl.value === "oldest" ? 1 : -1;
      dated.sort((a, b) => (getCardDate(a) - getCardDate(b)) * dir);

      // rebuild order in DOM (keep featured pinned first)
      const ordered = [...featured, ...undated, ...dated];
      for (const card of ordered) grid.appendChild(card);
    }

    searchEl.addEventListener("input", apply);
    sortEl.addEventListener("change", apply);
    apply();
  </script>
</BaseLayout>