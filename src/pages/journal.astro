---
import BaseLayout from "../layouts/BaseLayout.astro";

/**
 * This loads all markdown posts from: src/content/journal/*.md
 * It does NOT require Notion or any API.
 */
const modules = import.meta.glob("../content/journal/*.md", { eager: true });

const posts = Object.entries(modules).map(([path, mod]) => {
  const frontmatter = mod.frontmatter ?? {};
  const urlSlug = path.split("/").pop()?.replace(".md", "") ?? "";

  return {
    title: frontmatter.title ?? "Untitled",
    date: frontmatter.date ?? "",
    summary: frontmatter.summary ?? "",
    draft: frontmatter.draft ?? false,
    slug: urlSlug,
  };
});

// Hide drafts
const published = posts
  .filter((p) => !p.draft)
  .sort((a, b) => (b.date || "").localeCompare(a.date || ""));
---

<BaseLayout title="Journal | Riverside Homestead">
  <section class="journalPageHero journalHeroClean">
    <div class="container journalPageHeroInner">
      <h1 class="journalPageTitle">Journal</h1>
      <div class="journalPageDash" aria-hidden="true"></div>
      <p class="journalPageIntro">
        Updates, reflections, and small moments — written softly, shared when ready.
      </p>
    </div>
  </section>

  <section class="journalFeed">
    <div class="container journalFeedInner">
      {published.length > 0 ? (
        <div class="journalCardsGrid">
          {published.map((p) => (
            <article class="journalEntryCard">
              {p.date ? (
                <div class="journalEntryMeta">
                  <span class="journalEntryDate">
                    {new Date(p.date).toLocaleDateString(undefined, {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                    })}
                  </span>
                </div>
              ) : null}

              <h3 class="journalEntryTitle">{p.title}</h3>

              {p.summary ? (
                <p class="journalEntrySummary">{p.summary}</p>
              ) : null}

              <a class="journalReadMore" href={`/journal/${p.slug}`}>
                Read →
              </a>
            </article>
          ))}
        </div>
      ) : (
        <div class="journalEmptyCard">
          <h3>Nothing here yet</h3>
          <p>
            Once you add a post in <code>src/content/journal</code>, it will show up here.
          </p>
        </div>
      )}
    </div>
  </section>
</BaseLayout>