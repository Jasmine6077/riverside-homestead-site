---
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = await Astro.glob("./*.md");

// newest first (by date in frontmatter)
const sorted = posts
  .filter((p) => p.frontmatter?.date)
  .sort((a, b) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime());

const fmt = (d) =>
  new Date(d).toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" });
---

<BaseLayout title="Journal | Riverside Homestead">
  <section class="journalWrap">
    <div class="journalTop">
      <div class="journalHead">
        <h1 class="journalTitle">Journal</h1>
        <p class="journalIntro">
          A living space for updates, reflections, and little moments from the homestead.
        </p>
      </div>
    </div>

    <p class="journalFirstLine">
      A place for slow words, gentle growth, and honest days.
    </p>

    {sorted.length > 0 ? (
      <div class="journalMasonry" aria-label="Journal posts">
        {sorted.map((post) => (
          <a class="journalCard" href={post.url}>
            <div class="journalCardTop">
              <span class="journalDate">{fmt(post.frontmatter.date)}</span>
              {post.frontmatter?.tag ? <span class="journalTag">{post.frontmatter.tag}</span> : null}
            </div>

            <h2 class="journalCardTitle">{post.frontmatter.title}</h2>

            {post.frontmatter?.summary ? (
              <p class="journalCardSummary">{post.frontmatter.summary}</p>
            ) : (
              <p class="journalCardSummary journalCardSummaryMuted">Read the entry →</p>
            )}

            <div class="journalCardFooter">
              <span class="journalRead">Read</span>
              <span class="journalArrow" aria-hidden="true">→</span>
            </div>
          </a>
        ))}
      </div>
    ) : (
      <div class="journalEmpty">
        <h2>Nothing here yet</h2>
        <p>Add a new markdown file in <code>src/pages/journal/</code> and it’ll appear here.</p>
      </div>
    )}
  </section>
</BaseLayout>
